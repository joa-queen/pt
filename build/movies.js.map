{"version":3,"sources":["../js/movie.jsx","../js/movies.jsx","../js/player.jsx"],"names":[],"mappings":"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","file":"movies.js","sourcesContent":["var Movie = React.createClass({\n  render: function() {\n    var movie = this.props.movie;\n    var Plot;\n    if (!movie.plot) {\n      Plot = <div>Cargando plot...</div>;\n    } else {\n      Plot = <div>{movie.plot}</div>\n    }\n\n    var styles = {\n      cover: {\n        width: '100%'\n      }\n    };\n    return (\n      <div>\n        <a href=\"#\" onClick={this.props.unselectMovie}>Volver</a>\n        <img src={movie.background_image} style={styles.cover} />\n        <h1>{movie.title}</h1>\n        Rating: {movie.rating}<br />\n        {movie.runtime}m - {movie.year} - {movie.genres.join(', ')}<br /><br />\n        {Plot}\n\n        <br /><br /><br />\n        <button onClick={this.props.playMovie}>Reproducir</button>\n      </div>\n    );\n  }\n});\n","var superagent = require('superagent');\nvar gui = require('nw.gui');\n\nvar Movies = React.createClass({\n  getInitialState: function() {\n    return {\n      selected: null,\n      movies: null,\n      magnet: null,\n    };\n  },\n  componentDidMount: function() {\n    superagent\n      .get('https://yts.ag/api/v2/list_movies.json')\n      .set('Accept', 'application/json')\n      .end(function(err, res){\n        if (res.body.status == 'ok') {\n          this.setState({movies: res.body.data.movies});\n        }\n      }.bind(this));\n  },\n  selectMovie: function(index, event) {\n    this.resizeWindow(300, 500);\n    this.setState({selected: index});\n\n    var movie = this.state.movies[index];\n    if (!movie.plot) {\n      this.loadPlot(index);\n    }\n  },\n  unselectMovie: function() {\n    this.resizeWindow(300, 150);\n    this.setState({selected: null});\n  },\n  playMovie: function() {\n    var movie = this.state.movies[this.state.selected];\n\n    var playerWindow = gui.Window.open('../player.html?hash=' + movie.torrents[0].hash, {\n      \"title\": movie.title,\n      \"toolbar\": false,\n      \"frame\": false,\n      \"width\": 800,\n      \"height\": 500,\n      \"position\": \"center\",\n      \"show\": true\n    });\n  },\n  resizeWindow: function(w, h) {\n    window.resizeTo(w, h);\n  },\n  loadPlot: function(index) {\n    var movies = this.state.movies;\n    var movie = movies[index];\n    superagent\n      .get('http://www.omdbapi.com/')\n      .query({i: movie.imdb_code})\n      .set('Accept', 'application/json')\n      .end(function(err, res){\n        movie.plot = res.body.Plot;\n        movies[index] = movie;\n        this.setState({movies: movies});\n      }.bind(this));\n  },\n  render: function() {\n    var Content;\n    if (!this.state.movies) {\n      Content = <div>Cargando...</div>;\n    } else {\n      if (!this.state.magnet) {\n        if (this.state.selected) {\n          var movie = this.state.movies[this.state.selected];\n          Content = <Movie movie={movie} unselectMovie={this.unselectMovie} playMovie={this.playMovie} />;\n        } else {\n          var _self = this;\n          Content = (\n            <div>\n              <h2>Movies</h2>\n              <ul>\n                {this.state.movies.map(function(movie, i) {\n                  return (\n                    <li key={i}><a href=\"#\" onClick={_self.selectMovie.bind(_self, i)}>{movie.title}</a></li>\n                  );\n                })}\n              </ul>\n            </div>\n          );\n        }\n      } else {\n        Content = <Streaming magnet={this.state.magnet} />;\n      }\n    }\n    return (\n      <div>{Content}</div>\n    );\n  }\n});\n\nReactDOM.render(\n  <Movies />,\n  document.getElementById('container')\n);\n","var peerflix = require('peerflix');\nvar url = require('url');\nvar BUFFERING_SIZE = 3 * 1024 * 1024;\n\nvar Player = React.createClass({\n  src: null,\n  getInitialState: function() {\n    return {\n      downloaded: 0\n    };\n  },\n  componentWillMount: function() {\n    var _self = this;\n\n    var url_parts = url.parse(request.url, true);\n    var hash = url_parts.hash;\n    var magnetLink = 'magnet:?xt=urn:btih:' + hash;\n    var engine = peerflix(magnetLink);\n\n    engine.server.on('listening', function() {\n      this.src = 'http://localhost:' + engine.server.address().port + '/';\n    });\n\n    setInterval(function() {\n      _self.setState({downloaded: engine.swarm.downloaded});\n    }, 3000);\n  },\n  render: function() {\n    var Content;\n    if (this.state.downloaded > BUFFERING_SIZE) {\n      Content = (\n        <video ref=\"player\" width=\"100%\" height=\"100%\" controls preload=\"auto\" autoPlay >\n          <source src={this.src} type=\"video/mp4\" />\n        </video>\n      );\n    } else {\n      Content = <div>Buffering: {this.state.downloaded} / </div>;\n    }\n    return Content;\n  }\n});\n\nReactDOM.render(\n  <Player />,\n  document.getElementById('container')\n);\n"]}